---
title: Network Layer in OSI
tag: ComputerNetwork
---

# the outline of network layer
## 功能：转发与路由选择
### 转发
* 路由器对经由它的流量进行转发，使网络中的数据流能正确的从源地址到目的地址
* 一个路由器
### 路由选择
* 通过某种方式了解到网络的整体信息，通过这些信息寻找到一个正确的好‘路’从而发送数据
* 一个网络中的所有路由器
* 路由选择算法可以是集中式的也可以是分布式的
### 网络层对运输层提供的特定服务：尽力而为的服务
* 确保交付
* 具有时延上限的确保交付
* 有序分组交付
* 确保最小带宽
* 确保最大时延抖动：接收方与发送方的两个相邻分组的时间应该差不多
## 虚电路(VC)与数据报:网络层连接服务的连接方式，其中因特网使用数据报模式
### 虚电路的工作方式
* 虚电路建立：网络层决定发送方与接收方的路径，建立虚电路，为虚电路中的每个段**分配一个VC号**，(注：是逻辑序号，两台路由器之间的链路可由多个VC号)，建立期间为中间的每一个路由器**添加转发表表项**，同时**预留资源**等
* 数据传送：如名
* 虚电路拆除：**删除转发表表项**

### 数据报: 应用于internet的原因：简单，不浪费
* 数据报：将目的地址加到数据报上推到网络上
* ip地址的最长前缀匹配

### 路由器的工作原理
#### 路由器组成 ：路由器也运行着一个操作系统，这也是能够解析一些运行在应用层的网络层报的原因
* 多个输入端口
* 交换结构: 内存交换，总线交换，互连网络交换
* 多个输出端口
* 处理器
#### 路由器输入输出端口的排队现象
* 取决于流量，线路速率，交换速率，在端口的分布情况
* FCFS 随机早期检测
### ip协议
#### IPv4
* 选项字段，分片方法
* 如何编址
* 子网掩码
#### 静态ip分配与DHCP
#### NAT
* 在子网内，使用端口号映射为ip地址，将端到端转换为进程到进程
### 因特网控制控制报文协议：ICMP
* ICMP报文一般是是作为IP载荷
* 通过不同类型报告网路中的各种问题
### IPV6
* 首部40字节
* 与IPv4的三个主要区别
    * 不分片
    * 首部检验和
    * 选项
* 从ipv4迁移到ipv6
    * 双栈
    * 建隧道
### 路由选择
#### 全局式路由选择算法
* LS,Link State 链路状态算法
    * Dijkstra 算法
* 缺点容易形成震荡
    * 每个路由器随机运行算法
#### 分布式路由选择算法
* DV,Distance Vector 距离向量算法
    * Bellman-Ford方程
* 容易形成环路
    * 增加毒性逆转(poisoned reverse)
* 比较：复杂度，收敛速度，健壮性

#### 因特网中自治系统内部的路由选择：RIP, OSIP
#### 因特网中自治系统间的路由选择：BGP
#### 广播路由选择算法
* N次单播
* 无控制泛红
* 受控泛红：序号控制泛洪，反向路径转发
* 生成树广播
#### 组播：IGMP因特网组管理协议
* 运行在主机与第一条路由器之间
* 使用一个组共享树的多播路由选择
* 使用一个基于源的树的多播路由选择

